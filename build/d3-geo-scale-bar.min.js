!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d3=t.d3||{})}(this,function(t){"use strict";function n(t){return"translate("+(t+.5)+",0)"}function r(t){return function(n){return+t(n)}}function e(){return!this.__axis}function i(t,i){function o(t){var n=null==u?i.ticks?i.ticks.apply(i,a):i.domain():u,o=null==c?i.tickFormat?i.tickFormat.apply(i,a):function(t){return t}:c,d=Math.max(l,0)+f,m=i.range(),v=+m[0]+.5,M=+m[m.length-1]+.5,y=r(i.copy()),x=t.selection?t.selection():t,b=x.selectAll(".domain").data([null]),k=x.selectAll(".tick").data(n,i).order(),w=k.exit(),N=k.enter().append("g").attr("class","tick"),S=k.select("line"),A=k.select("text");b=b.merge(b.enter().insert("path",".tick").attr("class","domain").attr("stroke","#000")),k=k.merge(N),S=S.merge(N.append("line").attr("stroke","#000").attr(g+"2",h*l)),A=A.merge(N.append("text").attr("fill","#000").attr(g,h*d).attr("dy","0.71em")),t!==x&&(b=b.transition(t),k=k.transition(t),S=S.transition(t),A=A.transition(t),w=w.transition(t).attr("opacity",it).attr("transform",function(t){return isFinite(t=y(t))?p(t):this.getAttribute("transform")}),N.attr("opacity",it).attr("transform",function(t){var n=this.parentNode.__axis;return p(n&&isFinite(n=n(t))?n:y(t))})),w.remove(),b.attr("d",s?"M"+v+","+h*s+"V0.5H"+M+"V"+h*s:"M"+v+",0.5H"+M),k.attr("opacity",1).attr("transform",function(t){return p(y(t))}),S.attr(g+"2",h*l),A.attr(g,h*d).text(o),x.filter(e).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle"),x.each(function(){this.__axis=y})}var a=[],u=null,c=null,l=6,s=6,f=3,h=1,g="y",p=n;return o.scale=function(t){return arguments.length?(i=t,o):i},o.ticks=function(){return a=rt.call(arguments),o},o.tickArguments=function(t){return arguments.length?(a=null==t?[]:rt.call(t),o):a.slice()},o.tickValues=function(t){return arguments.length?(u=null==t?null:rt.call(t),o):u&&u.slice()},o.tickFormat=function(t){return arguments.length?(c=t,o):c},o.tickSize=function(t){return arguments.length?(l=s=+t,o):l},o.tickSizeInner=function(t){return arguments.length?(l=+t,o):l},o.tickSizeOuter=function(t){return arguments.length?(s=+t,o):s},o.tickPadding=function(t){return arguments.length?(f=+t,o):f},o}function o(t){return i(et,t)}function a(){this.reset()}function u(t,n,r){var e=t.s=n+r,i=e-n,o=e-i;t.t=n-o+(r-i)}function c(){}function l(t,n){t&&mt.hasOwnProperty(t.type)&&mt[t.type](t,n)}function s(t,n,r){var e,i=-1,o=t.length-r;for(n.lineStart();++i<o;)e=t[i],n.point(e[0],e[1],e[2]);n.lineEnd()}function f(t,n){var r=-1,e=t.length;for(n.polygonStart();++r<e;)s(t[r],n,1);n.polygonEnd()}function h(t,n){t&&dt.hasOwnProperty(t.type)?dt[t.type](t,n):l(t,n)}function g(){Mt.point=d,Mt.lineEnd=p}function p(){Mt.point=Mt.lineEnd=c}function d(t,n){t*=ht,n*=ht,ot=t,at=gt(n),ut=ft(n),Mt.point=m}function m(t,n){t*=ht,n*=ht;var r=gt(n),e=ft(n),i=lt(t-ot),o=ft(i),a=gt(i),u=e*a,c=ut*r-at*e*o,l=at*r+ut*e*o;vt.add(st(pt(u*u+c*c),l)),ot=t,at=r,ut=e}function v(t){return vt.reset(),h(t,Mt),+vt}function M(t,n){return yt[0]=t,yt[1]=n,v(xt)}function y(t,n,r){var e,i,o,a,u=-1;if(n=+n,t=+t,r=+r,t===n&&r>0)return[t];if((e=n<t)&&(i=t,t=n,n=i),0===(a=x(t,n,r))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),n=Math.floor(n/a),o=new Array(i=Math.ceil(n-t+1));++u<i;)o[u]=(t+u)*a;else for(t=Math.floor(t*a),n=Math.ceil(n*a),o=new Array(i=Math.ceil(t-n+1));++u<i;)o[u]=(t-u)/a;return e&&o.reverse(),o}function x(t,n,r){var e=(n-t)/Math.max(0,r),i=Math.floor(Math.log(e)/Math.LN10),o=e/Math.pow(10,i);return i>=0?(o>=bt?10:o>=kt?5:o>=wt?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=bt?10:o>=kt?5:o>=wt?2:1)}function b(t,n,r){var e=Math.abs(n-t)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(e)/Math.LN10)),o=e/i;return o>=bt?i*=10:o>=kt?i*=5:o>=wt&&(i*=2),n<t?-i:i}function k(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function w(t){return function(n,r){return k(t(n),r)}}function N(t,n){return t=+t,n=+n,function(r){return t*(1-r)+n*r}}function S(t,n){return t=+t,n=+n,function(r){return Math.round(t*(1-r)+n*r)}}function A(t,n){return N(t,n)}function z(t){return function(){return t}}function P(t){return+t}function F(t){return t}function E(t,n){return(n-=t=+t)?function(r){return(r-t)/n}:z(isNaN(n)?NaN:.5)}function j(t,n){var r;return t>n&&(r=t,t=n,n=r),function(r){return Math.max(t,Math.min(n,r))}}function _(t,n,r){var e=t[0],i=t[1],o=n[0],a=n[1];return i<e?(e=E(i,e),o=r(a,o)):(e=E(e,i),o=r(o,a)),function(t){return o(e(t))}}function O(t,n,r){var e=Math.min(t.length,n.length)-1,i=new Array(e),o=new Array(e),a=-1;for(t[e]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());++a<e;)i[a]=E(t[a],t[a+1]),o[a]=r(n[a],n[a+1]);return function(n){var r=St(t,n,1,e)-1;return o[r](i[r](n))}}function C(t,n){return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function L(){function t(){var t=Math.min(c.length,l.length);return f!==F&&(f=j(c[0],c[t-1])),o=t>2?O:_,a=u=null,n}function n(t){return isNaN(t=+t)?i:(a||(a=o(c.map(r),l,s)))(r(f(t)))}var r,e,i,o,a,u,c=At,l=At,s=A,f=F;return n.invert=function(t){return f(e((u||(u=o(l,c.map(r),N)))(t)))},n.domain=function(n){return arguments.length?(c=Array.from(n,P),t()):c.slice()},n.range=function(n){return arguments.length?(l=Array.from(n),t()):l.slice()},n.rangeRound=function(n){return l=Array.from(n),s=S,t()},n.clamp=function(n){return arguments.length?(f=!!n||F,t()):f!==F},n.interpolate=function(n){return arguments.length?(s=n,t()):s},n.unknown=function(t){return arguments.length?(i=t,n):i},function(n,i){return r=n,e=i,t()}}function V(){return L()(F,F)}function $(t,n){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(n).domain(t)}return this}function q(t,n){if((r=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var r,e=t.slice(0,r);return[e.length>1?e[0]+e.slice(2):e,+t.slice(r+1)]}function G(t){return t=q(Math.abs(t)),t?t[1]:NaN}function H(t,n){return function(r,e){for(var i=r.length,o=[],a=0,u=t[0],c=0;i>0&&u>0&&(c+u+1>e&&(u=Math.max(1,e-c)),o.push(r.substring(i-=u,i+u)),!((c+=u+1)>e));)u=t[a=(a+1)%t.length];return o.reverse().join(n)}}function I(t){return function(n){return n.replace(/[0-9]/g,function(n){return t[+n]})}}function U(t){if(!(n=zt.exec(t)))throw new Error("invalid format: "+t);var n;return new X({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}function X(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function B(t){t:for(var n,r=t.length,e=1,i=-1;e<r;++e)switch(t[e]){case".":i=n=e;break;case"0":0===i&&(i=e),n=e;break;default:if(i>0){if(!+t[e])break t;i=0}}return i>0?t.slice(0,i)+t.slice(n+1):t}function R(t,n){var r=q(t,n);if(!r)return t+"";var e=r[0],i=r[1],o=i-(Pt=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=e.length;return o===a?e:o>a?e+new Array(o-a+1).join("0"):o>0?e.slice(0,o)+"."+e.slice(o):"0."+new Array(1-o).join("0")+q(t,Math.max(0,n+o-1))[0]}function T(t,n){var r=q(t,n);if(!r)return t+"";var e=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+e:e.length>i+1?e.slice(0,i+1)+"."+e.slice(i+1):e+new Array(i-e.length+2).join("0")}function Y(t){return t}function Z(t){function n(t){function n(t){var n,i,o,c=x,g=b;if("c"===y)g=k(t)+g,t="";else{t=+t;var N=t<0;if(t=isNaN(t)?s:k(Math.abs(t),v),M&&(t=B(t)),N&&0==+t&&(N=!1),c=(N?"("===h?h:l:"-"===h||"("===h?"":h)+c,g=("s"===y?Ct[8+Pt/3]:"")+g+(N&&"("===h?")":""),w)for(n=-1,i=t.length;++n<i;)if(48>(o=t.charCodeAt(n))||o>57){g=(46===o?a+t.slice(n+1):t.slice(n))+g,t=t.slice(0,n);break}}m&&!p&&(t=e(t,1/0));var S=c.length+t.length+g.length,A=S<d?new Array(d-S+1).join(r):"";switch(m&&p&&(t=e(A+t,A.length?d-g.length:1/0),A=""),f){case"<":t=c+t+g+A;break;case"=":t=c+A+t+g;break;case"^":t=A.slice(0,S=A.length>>1)+c+t+g+A.slice(S);break;default:t=A+c+t+g}return u(t)}t=U(t);var r=t.fill,f=t.align,h=t.sign,g=t.symbol,p=t.zero,d=t.width,m=t.comma,v=t.precision,M=t.trim,y=t.type;"n"===y?(m=!0,y="g"):_t[y]||(void 0===v&&(v=12),M=!0,y="g"),(p||"0"===r&&"="===f)&&(p=!0,r="0",f="=");var x="$"===g?i:"#"===g&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===g?o:/[%p]/.test(y)?c:"",k=_t[y],w=/[defgprs%]/.test(y);return v=void 0===v?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),n.toString=function(){return t+""},n}function r(t,r){var e=n((t=U(t),t.type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(G(r)/3))),o=Math.pow(10,-i),a=Ct[8+i/3];return function(t){return e(o*t)+a}}var e=void 0===t.grouping||void 0===t.thousands?Y:H(Ot.call(t.grouping,Number),t.thousands+""),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",u=void 0===t.numerals?Y:I(Ot.call(t.numerals,String)),c=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",s=void 0===t.nan?"NaN":t.nan+"";return{format:n,formatPrefix:r}}function D(t){return Math.max(0,-G(Math.abs(t)))}function J(t,n){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(G(n)/3)))-G(Math.abs(t)))}function K(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,G(n)-G(t))+1}function Q(t,n,r,e){var i,o=b(t,n,r);switch(e=U(null==e?",f":e),e.type){case"s":var a=Math.max(Math.abs(t),Math.abs(n));return null!=e.precision||isNaN(i=J(o,a))||(e.precision=i),jt(e,a);case"":case"e":case"g":case"p":case"r":null!=e.precision||isNaN(i=K(o,Math.max(Math.abs(t),Math.abs(n))))||(e.precision=i-("e"===e.type));break;case"f":case"%":null!=e.precision||isNaN(i=D(o))||(e.precision=i-2*("%"===e.type))}return Et(e)}function W(t){var n=t.domain;return t.tickFormat=function(t,r){var e=n();return Q(e[0],e[e.length-1],null==t?10:t,r)},t.ticks=function(t){var r=n();return y(r[0],r[r.length-1],null==t?10:t)},t}function tt(){var t=V();return t.copy=function(){return C(t,tt())},$.apply(t,arguments),W(t)}function nt(){function t(t){t.attr("width",e[0]).attr("height",e[1]);var d=e[0]*s,m=e[1]*f,v=i.invert([d,m]);a=a||Math.pow(10,n(M(i.invert([0,0]),i.invert([0,e[1]]))*g)-1);var y=a/(M(v,i.invert([d+1,m]))*g),x=tt().range([0,y]).domain([0,a]);1!==p&&x.domain([0,x.invert(y/p)]);var b=x.domain()[1],k=o().scale(x).tickValues(u||[0,b/4,b/2,b]).tickSize(l),w=t.select("g");w._groups[0][0]||(w=t.append("g").attr("class","scale-bar")),w.attr("transform","translate("+e[0]*s+", "+e[1]*f+")").call(k);var N=w.selectAll("rect").data(k.tickValues().map(function(t,n,r){return[t,r[n+1]]}).filter(function(t,n,r){return n!==r.length-1}));N.exit().remove(),N.enter().append("rect").attr("height",l).style("stroke","#000").style("fill",function(t,n){return n%2==0?"#000":"#fff"}).merge(N).attr("x",function(t){return x(t[0])}).attr("width",function(t){return x(t[1]-t[0])});var S=w.select(".label");S._groups[0][0]||(S=w.append("text").attr("class","label")),S.attr("class","label").style("fill","#000").style("text-anchor","start").style("font-size","12px").attr("y",-4),S.text(c||r(h))}function n(t){return Math.floor(t).toString().length}function r(t){return t.charAt(0).toUpperCase()+t.slice(1)}var e,i,a,u,c,l=4,s=0,f=0,h="kilometers",g=6371,p=1,d={miles:{radius:3959},kilometers:{radius:6371}};return t.extent=function(n){return arguments.length?(e=n,t):e},t.projection=function(n){return arguments.length?(i=n,t):i},t.units=function(n){return arguments.length?(h=n,Object.keys(d).includes(n)&&(g=d[n].radius),t):h},t.distance=function(n){return arguments.length?(a=+n,t):a},t.radius=function(n){return arguments.length?(g=+n,t):g},t.tickValues=function(n){return arguments.length?(u=n,t):u},t.label=function(n){return arguments.length?(c=n,t):c},t.height=function(n){return arguments.length?(l=+n,t):l},t.left=function(n){return arguments.length?(s=n>1?1:n<0?0:+n,t):s},t.top=function(n){return arguments.length?(f=n>1?1:n<0?0:+n,t):f},t.scaleFactor=function(n){return arguments.length?(p=n,t):p},t}var rt=Array.prototype.slice,et=3,it=1e-6;a.prototype={constructor:a,reset:function(){this.s=this.t=0},add:function(t){u(ct,t,this.t),u(this,ct.s,this.s),this.s?this.t+=ct.t:this.s=ct.t},valueOf:function(){return this.s}};var ot,at,ut,ct=new a,lt=Math.abs,st=Math.atan2,ft=Math.cos,ht=Math.PI/180,gt=Math.sin,pt=Math.sqrt,dt={Feature:function(t,n){l(t.geometry,n)},FeatureCollection:function(t,n){for(var r=t.features,e=-1,i=r.length;++e<i;)l(r[e].geometry,n)}},mt={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var r=t.coordinates,e=-1,i=r.length;++e<i;)t=r[e],n.point(t[0],t[1],t[2])},LineString:function(t,n){s(t.coordinates,n,0)},MultiLineString:function(t,n){for(var r=t.coordinates,e=-1,i=r.length;++e<i;)s(r[e],n,0)},Polygon:function(t,n){f(t.coordinates,n)},MultiPolygon:function(t,n){for(var r=t.coordinates,e=-1,i=r.length;++e<i;)f(r[e],n)},GeometryCollection:function(t,n){for(var r=t.geometries,e=-1,i=r.length;++e<i;)l(r[e],n)}},vt=function(){return new a}(),Mt={sphere:c,point:c,lineStart:g,lineEnd:c,polygonStart:c,polygonEnd:c},yt=[null,null],xt={type:"LineString",coordinates:yt},bt=Math.sqrt(50),kt=Math.sqrt(10),wt=Math.sqrt(2),Nt=function(t){return 1===t.length&&(t=w(t)),{left:function(n,r,e,i){for(null==e&&(e=0),null==i&&(i=n.length);e<i;){var o=e+i>>>1;t(n[o],r)<0?e=o+1:i=o}return e},right:function(n,r,e,i){for(null==e&&(e=0),null==i&&(i=n.length);e<i;){var o=e+i>>>1;t(n[o],r)>0?i=o:e=o+1}return e}}}(k),St=Nt.right,At=[0,1],zt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;U.prototype=X.prototype,X.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Pt,Ft,Et,jt,_t={"%":function(t,n){return(100*t).toFixed(n)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,n){return t.toExponential(n)},f:function(t,n){return t.toFixed(n)},g:function(t,n){return t.toPrecision(n)},o:function(t){return Math.round(t).toString(8)},p:function(t,n){return T(100*t,n)},r:T,s:R,X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},Ot=Array.prototype.map,Ct=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];!function(t){Ft=Z(t),Et=Ft.format,jt=Ft.formatPrefix}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),t.geoScaleBar=nt,Object.defineProperty(t,"__esModule",{value:!0})});